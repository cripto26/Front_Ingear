


===== D:\Front\src\App.tsx =====

import { Routes, Route, Navigate } from "react-router-dom";

import AppLayout from "./layout/AppLayout";

import HomePage from "./pages/HomePage";
import CotizadorPage from "./pages/CotizadorPage";
import AdministracionPage from "./pages/AdministracionPage";
import LogisticaPage from "./pages/LogisticaPage";
import IngenieriaPage from "./pages/IngenieriaPage";
import GerenciaPage from "./pages/GerenciaPage";
import LoginPage from "./pages/LoginPage";
import NotFoundPage from "./pages/NotFoundPage";

/**
 * MODO LOCAL (sin login por ahora):
 * - Dejamos /login disponible, pero NO bloqueamos las rutas.
 * - Esto te permite enfocarte en que el Cotizador funcione conectado a la API.
 */
export default function App() {
  return (
    <Routes>
      <Route path="/login" element={<LoginPage />} />

      <Route path="/" element={<AppLayout />}>
        <Route index element={<HomePage />} />
        <Route path="cotizador" element={<CotizadorPage />} />
        <Route path="administracion" element={<AdministracionPage />} />
        <Route path="logistica" element={<LogisticaPage />} />
        <Route path="ingenieria" element={<IngenieriaPage />} />
        <Route path="gerencia" element={<GerenciaPage />} />

        <Route path="*" element={<NotFoundPage />} />
      </Route>

      <Route path="*" element={<Navigate to="/" replace />} />
    </Routes>
  );
}


===== D:\Front\src\main.tsx =====

import React from "react";
import ReactDOM from "react-dom/client";
import { BrowserRouter } from "react-router-dom";

import { AuthProvider } from "./auth/AuthContext";
import App from "./App";
import "./styles.css";

ReactDOM.createRoot(document.getElementById("root")!).render(
  <React.StrictMode>
    <BrowserRouter>
      <AuthProvider>
        <App />
      </AuthProvider>
    </BrowserRouter>
  </React.StrictMode>
);


===== D:\Front\src\styles.css =====

:root {
  --bg: #0b1220;
  --card: rgba(255,255,255,0.06);
  --line: rgba(255,255,255,0.12);
  --text: rgba(255,255,255,0.92);
  --muted: rgba(255,255,255,0.62);
  --primary: #14b8a6;
  --danger: #fb7185;
}

* { box-sizing: border-box; }
body {
  margin: 0;
  font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Apple Color Emoji", "Segoe UI Emoji";
  background: radial-gradient(1200px 800px at 10% 10%, rgba(20,184,166,0.16), transparent 40%),
              radial-gradient(1200px 800px at 90% 10%, rgba(59,130,246,0.14), transparent 40%),
              var(--bg);
  color: var(--text);
}
a { color: inherit; text-decoration: none; }
h1,h2,h3 { margin: 0 0 8px 0; }
p { margin: 8px 0; }

.appShell {
  display: grid;
  grid-template-columns: 260px 1fr;
  min-height: 100vh;
}
.sidebar {
  border-right: 1px solid var(--line);
  padding: 18px 14px;
}
.brand { display: flex; gap: 10px; align-items: center; margin-bottom: 14px; }
.brandDot { width: 16px; height: 16px; border-radius: 99px; background: var(--primary); }
.brandName { font-weight: 800; }
.brandSub { font-size: 12px; color: var(--muted); }
.nav { display: flex; flex-direction: column; gap: 6px; }
.navItem {
  padding: 10px 10px;
  border-radius: 12px;
  border: 1px solid transparent;
  color: var(--muted);
}
.navItem.active, .navItem:hover {
  color: var(--text);
  border-color: var(--line);
  background: rgba(255,255,255,0.04);
}

.appMain { display: flex; flex-direction: column; }
.topbar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 14px 18px;
  border-bottom: 1px solid var(--line);
}
.topbarLeft, .topbarRight { display: flex; align-items: center; gap: 10px; }
.userBox { text-align: right; }
.userName { font-weight: 700; }
.userRole { font-size: 12px; color: var(--muted); }

.appContent { padding: 18px; }

.card {
  background: var(--card);
  border: 1px solid var(--line);
  border-radius: 18px;
  padding: 16px;
}
.cardSub {
  margin-top: 12px;
  padding: 12px;
  border-radius: 14px;
  border: 1px dashed var(--line);
  background: rgba(255,255,255,0.03);
}
.muted { color: var(--muted); }
.strong { font-weight: 800; }
.hint { margin-top: 10px; font-size: 12px; color: var(--muted); }

.center { min-height: 100vh; display: flex; align-items: center; justify-content: center; padding: 18px; }

.form { display: grid; gap: 10px; margin-top: 10px; }
label { display: grid; gap: 6px; color: var(--muted); font-size: 13px; }
input, textarea {
  background: rgba(255,255,255,0.05);
  border: 1px solid var(--line);
  color: var(--text);
  padding: 10px 12px;
  border-radius: 12px;
  outline: none;
}
input:focus, textarea:focus { border-color: rgba(20,184,166,0.55); }

.btn, .btnPrimary, .btnDanger {
  padding: 10px 12px;
  border-radius: 12px;
  border: 1px solid var(--line);
  background: rgba(255,255,255,0.04);
  color: var(--text);
  cursor: pointer;
}
.btn:hover { background: rgba(255,255,255,0.07); }
.btnPrimary {
  border-color: rgba(20,184,166,0.45);
  background: rgba(20,184,166,0.14);
}
.btnPrimary:hover { background: rgba(20,184,166,0.22); }
.btnDanger {
  border-color: rgba(251,113,133,0.35);
  background: rgba(251,113,133,0.12);
}
.btnDanger:hover { background: rgba(251,113,133,0.20); }

.error {
  padding: 10px 12px;
  border-radius: 12px;
  border: 1px solid rgba(251,113,133,0.35);
  background: rgba(251,113,133,0.12);
}

.pill {
  padding: 6px 10px;
  border-radius: 999px;
  border: 1px solid var(--line);
  color: var(--muted);
  font-size: 12px;
}

.pageHeader { margin-bottom: 12px; }

.grid2 {
  display: grid;
  grid-template-columns: 1fr 1.2fr;
  gap: 14px;
}
@media (max-width: 1100px) {
  .appShell { grid-template-columns: 1fr; }
  .sidebar { display: none; }
  .grid2 { grid-template-columns: 1fr; }
}

.row { display: flex; align-items: center; gap: 10px; justify-content: space-between; margin: 10px 0; }

.tableWrap { overflow: auto; border-radius: 14px; border: 1px solid var(--line); }
.table {
  width: 100%;
  border-collapse: collapse;
  min-width: 760px;
}
th, td {
  padding: 10px 10px;
  border-bottom: 1px solid rgba(255,255,255,0.08);
  vertical-align: top;
}
th { text-align: left; color: var(--muted); font-weight: 700; font-size: 12px; }
.tdWrap { max-width: 420px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

.formGrid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 10px;
}
.span2 { grid-column: span 2; }

.kv {
  display: grid;
  grid-template-columns: 1fr auto;
  gap: 8px 12px;
  margin-top: 8px;
}


===== D:\Front\src\api\clienteApi.ts =====

import { http } from "../lib/http";

export type Cliente = {
  id: number;
  razon_social: string;
  nit: string;
  email?: string | null;
  telefono?: string | null;
  ciudad?: string | null;
};

export async function listClientes() {
  return http<Cliente[]>("/clientes");
}


===== D:\Front\src\api\cotizacionApi.ts =====

import { http } from "../lib/http";

export type Cotizacion = {
  id: number;
  consecutivo: string;
  id_cotizador: number;
  url_cotizacion?: string | null;
  tiempo_entrega?: string | null;
  nombre_cotizacion?: string | null;
  tipo_cotizacion?: string | null;
  etapa_cotizacion?: string | null;
  forma_pago?: string | null;
  total?: string | number | null;
  fecha_creacion: string;
};

/**
 * Nota importante:
 * Tu modelo SQLAlchemy exige id_proyecto en Cotizacion, pero tu schema actual no lo incluye.
 * Mientras lo ajustas en la API, en el front trabajaremos el â€œborradorâ€ local del cotizador.
 */
export async function listCotizaciones() {
  return http<Cotizacion[]>("/cotizaciones");
}


===== D:\Front\src\api\empleadoApi.ts =====

import { http } from "../lib/http";

export type Empleado = {
  id: number;
  nombre: string;
  email?: string | null;
  cargo?: string | null;
  area?: string | null;
  estado?: string | null;
  cedula?: string | null;
  telefono?: string | null;
};

export async function listEmpleados() {
  return http<Empleado[]>("/empleados");
}

/**
 * Login temporal:
 * - busca por email o cÃ©dula dentro de /empleados
 * - si no existe, error
 */
export async function findEmpleadoByLogin(emailOrCedula: string) {
  const empleados = await listEmpleados();
  const key = emailOrCedula.trim().toLowerCase();

  const found = empleados.find((e) => {
    const email = (e.email ?? "").toLowerCase();
    const ced = (e.cedula ?? "").toLowerCase();
    return email === key || ced === key;
  });

  if (!found) {
    throw new Error("Empleado no encontrado. Verifica email o cÃ©dula.");
  }
  return found;
}


===== D:\Front\src\api\productoApi.ts =====

import { http } from "../lib/http";

export type Producto = {
  id: number;
  codigo_producto: string;
  marca?: string | null;
  descripcion?: string | null;

  // Campos â€œsensiblesâ€ (mostrar segÃºn rol)
  costo_instalacion?: string | number | null;
  costo_fabrica?: string | number | null;
  descuento_fabricante?: string | number | null;
  costo_ingear?: string | number | null;

  url_imagen?: string | null;
  url_ficha_tecnica?: string | null;

  moneda?: string | null;
  cantidad_inventario?: number;
};

export async function listProductos() {
  return http<Producto[]>("/productos");
}


===== D:\Front\src\api\proyectoApi.ts =====

import { http } from "../lib/http";

export type Proyecto = {
  id: number;
  nombre: string;
  oportunidad_id?: number | null;
};

export async function listProyectos() {
  return http<Proyecto[]>("/proyectos");
}


===== D:\Front\src\auth\AuthContext.tsx =====

import React, { createContext, useContext, useEffect, useMemo, useState } from "react";
import type { AuthState, SessionUser, Role } from "./authTypes";
import { findEmpleadoByLogin } from "../api/empleadoApi";

type AuthContextValue = AuthState & {
  login: (payload: { emailOrCedula: string }) => Promise<void>;
  logout: () => void;
};

const AuthContext = createContext<AuthContextValue | null>(null);

const LS_KEY = "ingear.session.v1";

function inferRoleFromEmpleado(area?: string | null, cargo?: string | null): Role {
  const text = `${area ?? ""} ${cargo ?? ""}`.toLowerCase();

  if (text.includes("gerencia") || text.includes("director") || text.includes("gerente")) return "GERENCIA";
  if (text.includes("administracion") || text.includes("ventas") || text.includes("cotiz")) return "ADMINISTRACION";
  if (text.includes("logistica") || text.includes("logÃ­stica") || text.includes("despacho")) return "LOGISTICA";
  if (text.includes("ingenieria") || text.includes("ingenierÃ­a")) return "INGENIERIA";

  return "OTRO";
}

export function AuthProvider({ children }: { children: React.ReactNode }) {
  const [state, setState] = useState<AuthState>({ user: null, token: null });

  useEffect(() => {
    const raw = localStorage.getItem(LS_KEY);
    if (!raw) return;
    try {
      const parsed = JSON.parse(raw) as AuthState;
      setState(parsed);
    } catch {
      localStorage.removeItem(LS_KEY);
    }
  }, []);

  function persist(next: AuthState) {
    setState(next);
    localStorage.setItem(LS_KEY, JSON.stringify(next));
  }

  async function login(payload: { emailOrCedula: string }) {
    // Auth temporal: buscamos el empleado en tu API /empleados y lo â€œloggeamosâ€
    // Cuando tengas JWT, aquÃ­ cambias por /auth/login
    const empleado = await findEmpleadoByLogin(payload.emailOrCedula);

    const user: SessionUser = {
      id: empleado.id,
      nombre: empleado.nombre,
      email: empleado.email ?? null,
      area: empleado.area ?? null,
      cargo: empleado.cargo ?? null,
      role: inferRoleFromEmpleado(empleado.area, empleado.cargo)
    };

    persist({ user, token: "mock-token" });
  }

  function logout() {
    persist({ user: null, token: null });
  }

  const value = useMemo<AuthContextValue>(
    () => ({
      user: state.user,
      token: state.token,
      login,
      logout
    }),
    [state.user, state.token]
  );

  return <AuthContext.Provider value={value}>{children}</AuthContext.Provider>;
}

export function useAuth() {
  const ctx = useContext(AuthContext);
  if (!ctx) throw new Error("useAuth debe usarse dentro de AuthProvider");
  return ctx;
}

export type Role =
  | "ADMINISTRACION"
  | "LOGISTICA"
  | "INGENIERIA"
  | "GERENCIA"
  | "OTRO";

export type SessionUser = {
  id: number;
  nombre: string;
  email?: string | null;
  area?: string | null;
  cargo?: string | null;
  role: Role;
};

export type AuthState = {
  user: SessionUser | null;
  token: string | null; // placeholder para futuro JWT
};


===== D:\Front\src\auth\authTypes.ts =====



export type SessionUser = {
  id: number;
  nombre: string;
  email?: string | null;
  area?: string | null;
  cargo?: string | null;
  role: Role;
};

export type AuthState = {
  user: SessionUser | null;
  token: string | null; // placeholder para futuro JWT
};

export type Role =
  | "ADMINISTRACION"
  | "LOGISTICA"
  | "INGENIERIA"
  | "GERENCIA"
  | "OTRO";


===== D:\Front\src\auth\RequireAuth.tsx =====

import { Navigate } from "react-router-dom";
import { useAuth } from "./AuthContext";

export default function RequireAuth({ children }: { children: JSX.Element }) {
  const { user } = useAuth();
  if (!user) return <Navigate to="/login" replace />;
  return children;
}


===== D:\Front\src\auth\RequireRole.tsx =====

import { Navigate } from "react-router-dom";
import { ENV } from "../config/env";
import { useAuth } from "./AuthContext";
import type { Role } from "./authTypes";

export default function RequireRole({
  roles,
  children
}: {
  roles: Role[];
  children: JSX.Element;
}) {
  // En mock dejamos pasar todo
  if ((ENV.AUTH_MODE ?? "mock") === "mock") return children;

  const { user } = useAuth();
  if (!user) return <Navigate to="/login" replace />;

  if (!roles.includes(user.role)) return <Navigate to="/" replace />;

  return children;
}


===== D:\Front\src\config\env.ts =====

export const ENV = {
  API_BASE_URL: import.meta.env.VITE_API_BASE_URL as string,
  AUTH_MODE: (import.meta.env.VITE_AUTH_MODE as string) ?? "mock"
};


===== D:\Front\src\features\cotizador\cotizadorTypes.ts =====

import type { Producto } from "../../api/productoApi";

export type QuoteLine = {
  product: Producto;
  qty: number;
  salePrice: number; // precio de venta (visible para roles permitidos)
};

export type QuoteDraft = {
  customerName: string;
  projectName: string;
  city: string;
  notes: string;
  lines: QuoteLine[];
};


===== D:\Front\src\features\cotizador\CotizadorUI.tsx =====

import { useEffect, useMemo, useState } from "react";
import { listProductos, type Producto } from "../../api/productoApi";
import { formatCOP, toNumber } from "../../lib/money";
import { useAuth } from "../../auth/AuthContext";
import { canViewSensitivePricing } from "./rules";
import type { QuoteDraft, QuoteLine } from "./cotizadorTypes";

function calcSuggestedSale(product: Producto) {
  // Regla inicial (placeholder): venta = costo_ingear * 1.25
  // Ajusta con mÃ¡rgenes reales despuÃ©s
  const base = toNumber(product.costo_ingear);
  if (!base) return 0;
  return base * 1.25;
}

export default function CotizadorUI() {
  const { user } = useAuth();
  const allowSensitive = canViewSensitivePricing(user);

  const [products, setProducts] = useState<Producto[]>([]);
  const [query, setQuery] = useState("");
  const [loading, setLoading] = useState(true);
  const [err, setErr] = useState<string | null>(null);

  const [draft, setDraft] = useState<QuoteDraft>({
    customerName: "",
    projectName: "",
    city: "",
    notes: "",
    lines: []
  });

  useEffect(() => {
    (async () => {
      try {
        setLoading(true);
        const data = await listProductos();
        setProducts(data);
      } catch (e: any) {
        setErr(e?.message ?? "No se pudo cargar productos");
      } finally {
        setLoading(false);
      }
    })();
  }, []);

  const filtered = useMemo(() => {
    const q = query.trim().toLowerCase();
    if (!q) return products.slice(0, 50);
    return products
      .filter((p) => {
        const a = (p.codigo_producto ?? "").toLowerCase();
        const b = (p.marca ?? "").toLowerCase();
        const c = (p.descripcion ?? "").toLowerCase();
        return a.includes(q) || b.includes(q) || c.includes(q);
      })
      .slice(0, 50);
  }, [products, query]);

  function addLine(product: Producto) {
    setDraft((d) => {
      const existing = d.lines.find((l) => l.product.id === product.id);
      if (existing) {
        return {
          ...d,
          lines: d.lines.map((l) =>
            l.product.id === product.id ? { ...l, qty: l.qty + 1 } : l
          )
        };
      }
      const suggested = calcSuggestedSale(product);
      const newLine: QuoteLine = { product, qty: 1, salePrice: suggested };
      return { ...d, lines: [newLine, ...d.lines] };
    });
  }

  function updateQty(productId: number, qty: number) {
    setDraft((d) => ({
      ...d,
      lines: d.lines.map((l) => (l.product.id === productId ? { ...l, qty } : l))
    }));
  }

  function updateSalePrice(productId: number, salePrice: number) {
    setDraft((d) => ({
      ...d,
      lines: d.lines.map((l) => (l.product.id === productId ? { ...l, salePrice } : l))
    }));
  }

  function removeLine(productId: number) {
    setDraft((d) => ({ ...d, lines: d.lines.filter((l) => l.product.id !== productId) }));
  }

  const totals = useMemo(() => {
    const subtotal = draft.lines.reduce((acc, l) => acc + l.qty * (l.salePrice || 0), 0);
    const iva = subtotal * 0.19;
    const total = subtotal + iva;

    // margen aproximado (si tenemos costo_ingear y permisos)
    const cost = draft.lines.reduce((acc, l) => acc + l.qty * toNumber(l.product.costo_ingear), 0);
    const gross = subtotal - cost;
    const marginPct = subtotal ? (gross / subtotal) * 100 : 0;

    return { subtotal, iva, total, cost, gross, marginPct };
  }, [draft.lines]);

  return (
    <div className="grid2">
      <div className="card">
        <h3>Datos de la cotizaciÃ³n (borrador)</h3>

        <div className="formGrid">
          <label>
            Cliente
            <input
              value={draft.customerName}
              onChange={(e) => setDraft((d) => ({ ...d, customerName: e.target.value }))}
              placeholder="RazÃ³n social"
            />
          </label>

          <label>
            Proyecto
            <input
              value={draft.projectName}
              onChange={(e) => setDraft((d) => ({ ...d, projectName: e.target.value }))}
              placeholder="Nombre del proyecto"
            />
          </label>

          <label>
            Ciudad
            <input
              value={draft.city}
              onChange={(e) => setDraft((d) => ({ ...d, city: e.target.value }))}
              placeholder="MedellÃ­n"
            />
          </label>

          <label className="span2">
            Observaciones
            <textarea
              value={draft.notes}
              onChange={(e) => setDraft((d) => ({ ...d, notes: e.target.value }))}
              placeholder="Notas internas / condiciones"
              rows={3}
            />
          </label>
        </div>

        <div className="cardSub">
          <h4>Resumen</h4>
          <div className="kv">
            <div>Subtotal</div>
            <div>{formatCOP(totals.subtotal)}</div>

            <div>IVA (19%)</div>
            <div>{formatCOP(totals.iva)}</div>

            <div className="strong">Total</div>
            <div className="strong">{formatCOP(totals.total)}</div>

            {allowSensitive && (
              <>
                <div>Costo (aprox)</div>
                <div>{formatCOP(totals.cost)}</div>

                <div>Utilidad bruta (aprox)</div>
                <div>{formatCOP(totals.gross)}</div>

                <div>Margen (%)</div>
                <div>{totals.marginPct.toFixed(2)}%</div>
              </>
            )}
          </div>
          {!allowSensitive && (
            <div className="hint">
              * Tu rol no permite ver costos/descuentos/mÃ¡rgenes. (Esto se controla por rol.)
            </div>
          )}
        </div>

        <div className="hint">
          Esta pantalla es UI base del cotizador. La creaciÃ³n de cotizaciones en BD la activamos cuando tu
          API tenga `id_proyecto` en el schema de CotizaciÃ³n. :contentReference[oaicite:2]{index=2}
        </div>
      </div>

      <div className="card">
        <h3>CatÃ¡logo de productos</h3>

        <div className="row">
          <input
            value={query}
            onChange={(e) => setQuery(e.target.value)}
            placeholder="Buscar por cÃ³digo, marca o descripciÃ³n..."
          />
          <div className="pill">{products.length} productos</div>
        </div>

        {loading && <p className="muted">Cargando...</p>}
        {err && <div className="error">{err}</div>}

        <div className="tableWrap">
          <table className="table">
            <thead>
              <tr>
                <th>CÃ³digo</th>
                <th>Marca</th>
                <th>DescripciÃ³n</th>
                <th>Inventario</th>
                {allowSensitive && <th>Costo Ingear</th>}
                <th>Agregar</th>
              </tr>
            </thead>
            <tbody>
              {filtered.map((p) => (
                <tr key={p.id}>
                  <td>{p.codigo_producto}</td>
                  <td>{p.marca ?? "-"}</td>
                  <td className="tdWrap">{p.descripcion ?? "-"}</td>
                  <td>{p.cantidad_inventario ?? 0}</td>
                  {allowSensitive && <td>{formatCOP(toNumber(p.costo_ingear))}</td>}
                  <td>
                    <button className="btn" onClick={() => addLine(p)}>
                      + AÃ±adir
                    </button>
                  </td>
                </tr>
              ))}
              {!loading && filtered.length === 0 && (
                <tr>
                  <td colSpan={allowSensitive ? 6 : 5} className="muted">
                    Sin resultados.
                  </td>
                </tr>
              )}
            </tbody>
          </table>
        </div>

        <h3 style={{ marginTop: 18 }}>Items de cotizaciÃ³n</h3>
        <div className="tableWrap">
          <table className="table">
            <thead>
              <tr>
                <th>Producto</th>
                <th>Cant.</th>
                <th>Precio venta</th>
                {allowSensitive && <th>Costo</th>}
                {allowSensitive && <th>Utilidad</th>}
                <th>Subtotal</th>
                <th></th>
              </tr>
            </thead>
            <tbody>
              {draft.lines.map((l) => {
                const sub = l.qty * (l.salePrice || 0);
                const cost = l.qty * toNumber(l.product.costo_ingear);
                const profit = sub - cost;

                return (
                  <tr key={l.product.id}>
                    <td>
                      <div className="strong">{l.product.codigo_producto}</div>
                      <div className="muted">{l.product.descripcion ?? ""}</div>
                    </td>
                    <td style={{ width: 90 }}>
                      <input
                        type="number"
                        min={1}
                        value={l.qty}
                        onChange={(e) => updateQty(l.product.id, Math.max(1, Number(e.target.value)))}
                      />
                    </td>
                    <td style={{ width: 160 }}>
                      <input
                        type="number"
                        min={0}
                        value={l.salePrice}
                        onChange={(e) => updateSalePrice(l.product.id, Number(e.target.value))}
                      />
                    </td>

                    {allowSensitive && <td>{formatCOP(cost)}</td>}
                    {allowSensitive && <td>{formatCOP(profit)}</td>}

                    <td>{formatCOP(sub)}</td>
                    <td style={{ width: 90 }}>
                      <button className="btnDanger" onClick={() => removeLine(l.product.id)}>
                        Quitar
                      </button>
                    </td>
                  </tr>
                );
              })}

              {draft.lines.length === 0 && (
                <tr>
                  <td colSpan={allowSensitive ? 7 : 5} className="muted">
                    Agrega productos desde el catÃ¡logo.
                  </td>
                </tr>
              )}
            </tbody>
          </table>
        </div>

        <div className="row" style={{ justifyContent: "flex-end", marginTop: 12 }}>
          <button className="btn" onClick={() => setDraft((d) => ({ ...d, lines: [] }))}>
            Limpiar
          </button>
          <button className="btnPrimary" disabled>
            Guardar cotizaciÃ³n (pendiente API)
          </button>
        </div>
      </div>
    </div>
  );
}


===== D:\Front\src\features\cotizador\rules.ts =====

import type { SessionUser } from "../../auth/authTypes";

export type ModuleKey =
  | "COTIZADOR"
  | "ADMINISTRACION"
  | "LOGISTICA"
  | "INGENIERIA"
  | "GERENCIA";

/**
 * Reglas de acceso por mÃ³dulo (para cuando vuelvas a activar roles).
 * Por ahora puedes dejar el Sidebar sin filtrar, pero este archivo debe compilar bien.
 */
export function canAccessModule(user: SessionUser | null, module: ModuleKey) {
  if (!user) return false;

  // Gerencia ve todo
  if (user.role === "GERENCIA") return true;

  // Accesos por rol
  if (module === "COTIZADOR") return user.role === "ADMINISTRACION";
  if (module === "ADMINISTRACION") return user.role === "ADMINISTRACION";
  if (module === "LOGISTICA") return user.role === "LOGISTICA";
  if (module === "INGENIERIA") return user.role === "INGENIERIA";
  if (module === "GERENCIA") return user.role === "GERENCIA";

  return false;
}

/**
 * Controla si puede ver datos sensibles: costos, descuentos, mÃ¡rgenes, etc.
 */
export function canViewSensitivePricing(user: SessionUser | null) {
  if (!user) return false;
  return user.role === "GERENCIA" || user.role === "ADMINISTRACION";
}


===== D:\Front\src\layout\AppLayout.tsx =====

import { Outlet } from "react-router-dom";
import Sidebar from "./Sidebar";
import Topbar from "./Topbar";

export default function AppLayout() {
  return (
    <div className="appShell">
      <Sidebar />
      <div className="appMain">
        <Topbar />
        <div className="appContent">
          <Outlet />
        </div>
      </div>
    </div>
  );
}


===== D:\Front\src\layout\Sidebar.tsx =====

import { NavLink } from "react-router-dom";
import { useAuth } from "../auth/AuthContext";

type LinkItem = { to: string; label: string };

const links: LinkItem[] = [
  { to: "/", label: "Inicio" },
  { to: "/cotizador", label: "Cotizador" },
  { to: "/administracion", label: "AdministraciÃ³n" },
  { to: "/logistica", label: "LogÃ­stica" },
  { to: "/ingenieria", label: "IngenierÃ­a" },
  { to: "/gerencia", label: "Gerencia" }
];

/**
 * En este momento NO estamos aplicando permisos por rol (para enfocarnos en el Cotizador).
 * Luego, cuando retomes login/roles, volvemos a filtrar links por rol/mÃ³dulo.
 */
export default function Sidebar() {
  const { user } = useAuth();

  return (
    <aside className="sidebar">
      <div className="brand">
        <div className="brandDot" />
        <div>
          <div className="brandName">Ingear</div>
          <div className="brandSub">{user ? `Rol: ${user.role}` : "Modo local"}</div>
        </div>
      </div>

      <nav className="nav">
        {links.map((l) => (
          <NavLink
            key={l.to}
            to={l.to}
            className={({ isActive }) => (isActive ? "navItem active" : "navItem")}
          >
            {l.label}
          </NavLink>
        ))}
      </nav>
    </aside>
  );
}


===== D:\Front\src\layout\Topbar.tsx =====

import { Link } from "react-router-dom";
import { useAuth } from "../auth/AuthContext";

export default function Topbar() {
  const { user, logout } = useAuth();

  return (
    <header className="topbar">
      <div className="topbarLeft">
        <div className="topbarTitle">Cotizador</div>
      </div>

      <div className="topbarRight">
        <div className="user">
          <div className="userName">{user?.nombre ?? "Invitado"}</div>
          <div className="userRole">{user?.role ?? "SIN_ROL"}</div>
        </div>

        {/* Dejamos login disponible, pero no es obligatorio */}
        <Link className="btn" to="/login" style={{ textDecoration: "none" }}>
          Ir a Login
        </Link>

        <button className="btn" onClick={logout} type="button">
          Cerrar sesiÃ³n
        </button>
      </div>
    </header>
  );
}


===== D:\Front\src\lib\http.ts =====

import { ENV } from "../config/env";

export type HttpMethod = "GET" | "POST" | "PUT" | "DELETE";

export class HttpError extends Error {
  status: number;
  body: unknown;
  constructor(status: number, message: string, body: unknown) {
    super(message);
    this.status = status;
    this.body = body;
  }
}

function buildUrl(path: string) {
  const base = ENV.API_BASE_URL.replace(/\/$/, "");
  const p = path.startsWith("/") ? path : `/${path}`;
  return `${base}${p}`;
}

export async function http<T>(
  path: string,
  options?: {
    method?: HttpMethod;
    token?: string | null;
    body?: unknown;
    signal?: AbortSignal;
  }
): Promise<T> {
  const res = await fetch(buildUrl(path), {
    method: options?.method ?? "GET",
    headers: {
      "Content-Type": "application/json",
      ...(options?.token ? { Authorization: `Bearer ${options.token}` } : {})
    },
    body: options?.body ? JSON.stringify(options.body) : undefined,
    signal: options?.signal
  });

  const text = await res.text();
  const data = text ? safeJson(text) : null;

  if (!res.ok) {
    throw new HttpError(res.status, `HTTP ${res.status} en ${path}`, data);
  }

  return data as T;
}

function safeJson(text: string) {
  try {
    return JSON.parse(text);
  } catch {
    return text;
  }
}


===== D:\Front\src\lib\money.ts =====

export function formatCOP(value: number) {
  return new Intl.NumberFormat("es-CO", { style: "currency", currency: "COP" }).format(value);
}

export function toNumber(val: unknown) {
  const n = Number(val);
  return Number.isFinite(n) ? n : 0;
}


===== D:\Front\src\pages\AdministracionPage.tsx =====

export default function AdministracionPage() {
    return (
      <div className="card">
        <h2>MÃ³dulo Administracion</h2>
        <p className="muted">
          Placeholder. AquÃ­ irÃ¡n: Oportunidades, pipeline, seguimiento, tareas, etc.
        </p>
      </div>
    );
  }
  


===== D:\Front\src\pages\CotizadorPage.tsx =====

import CotizadorUI from "../features/cotizador/CotizadorUI";

export default function CotizadorPage() {
  return (
    <div>
      <div className="pageHeader">
        <h2>Cotizador</h2>
        <p className="muted">Interfaz base (PWA) conectada a tu API de productos.</p>
      </div>
      <CotizadorUI />
    </div>
  );
}


===== D:\Front\src\pages\GerenciaPage.tsx =====

export default function GerenciaPage() {
  return (
    <div className="card">
      <h2>MÃ³dulo Gerencia</h2>
      <p className="muted">Placeholder. AquÃ­ irÃ¡n: KPIs, aprobaciones, auditorÃ­a, reportes.</p>
    </div>
  );
}


===== D:\Front\src\pages\HomePage.tsx =====

import { useAuth } from "../auth/AuthContext";

export default function HomePage() {
  const { user } = useAuth();
  return (
    <div className="card">
      <h2>Bienvenido</h2>
      <p className="muted">
        Hola <b>{user?.nombre}</b>. Tu rol es <b>{user?.role}</b>.
      </p>
      <p>
        Este frontend estÃ¡ listo para crecer por mÃ³dulos: Administracion, LogÃ­stica, IngenierÃ­a y Gerencia.
      </p>
    </div>
  );
}


===== D:\Front\src\pages\IngenieriaPage.tsx =====

export default function IngenieriaPage() {
  return (
    <div className="card">
      <h2>MÃ³dulo IngenierÃ­a</h2>
      <p className="muted">Placeholder. AquÃ­ irÃ¡n: revisiones tÃ©cnicas, listas de materiales, etc.</p>
    </div>
  );
}


===== D:\Front\src\pages\LoginPage.tsx =====

import { useState } from "react";
import { useNavigate } from "react-router-dom";
import { useAuth } from "../auth/AuthContext";

export default function LoginPage() {
  const { login } = useAuth();
  const nav = useNavigate();
  const [emailOrCedula, setEmailOrCedula] = useState("");
  const [loading, setLoading] = useState(false);
  const [err, setErr] = useState<string | null>(null);

  async function onSubmit(e: React.FormEvent) {
    e.preventDefault();
    setErr(null);
    setLoading(true);
    try {
      await login({ emailOrCedula });
      nav("/", { replace: true });
    } catch (error: any) {
      setErr(error?.message ?? "Error iniciando sesiÃ³n");
    } finally {
      setLoading(false);
    }
  }

  return (
    <div className="center">
      <div className="card" style={{ width: 420 }}>
        <h1>Ingear</h1>
        <p className="muted">Ingresa con email o cÃ©dula (modo temporal).</p>

        <form onSubmit={onSubmit} className="form">
          <label>
            Email o CÃ©dula
            <input
              value={emailOrCedula}
              onChange={(e) => setEmailOrCedula(e.target.value)}
              placeholder="usuario@ingear.co o 12345678"
              required
            />
          </label>

          {err && <div className="error">{err}</div>}

          <button className="btnPrimary" disabled={loading}>
            {loading ? "Ingresando..." : "Iniciar sesiÃ³n"}
          </button>
        </form>
      </div>
    </div>
  );
}


===== D:\Front\src\pages\LogisticaPage.tsx =====

export default function LogisticaPage() {
  return (
    <div className="card">
      <h2>MÃ³dulo LogÃ­stica</h2>
      <p className="muted">Placeholder. AquÃ­ irÃ¡n: Despachos, estados, guÃ­as, transportadora.</p>
    </div>
  );
}


===== D:\Front\src\pages\NotFoundPage.tsx =====

export default function NotFoundPage() {
  return (
    <div className="card">
      <h2>No encontrado</h2>
      <p className="muted">La ruta no existe.</p>
    </div>
  );
}


===== .\.gitignore =====

node_modules/
dist/
.env
*.log


===== .\firebase.json =====

{
  "hosting": {
    "public": "dist",
    "ignore": ["firebase.json", "**/.*", "**/node_modules/**"],
    "headers": [
      {
        "source": "/manifest.webmanifest",
        "headers": [{ "key": "Content-Type", "value": "application/manifest+json" }]
      }
    ],
    "rewrites": [{ "source": "**", "destination": "/index.html" }]
  }
}


===== .\index.html =====

<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ingear Front</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>


===== .\package.json =====

{
  "name": "ingear-frontend",
  "private": true,
  "version": "0.1.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "tsc -b && vite build",
    "preview": "vite preview",
    "lint": "echo \"(opcional) agrega eslint\"",
    "firebase:init": "firebase init hosting",
    "deploy": "vite build && firebase deploy"
  },
  "dependencies": {
    "react": "^18.3.1",
    "react-dom": "^18.3.1",
    "react-router-dom": "^6.26.2"
  },
  "devDependencies": {
    "@types/react": "^18.3.8",
    "@types/react-dom": "^18.3.0",
    "@vitejs/plugin-react": "^4.3.2",
    "typescript": "^5.6.2",
    "vite": "^5.4.8",
    "vite-plugin-pwa": "^0.20.5"
  }
}


===== .\tsconfig.json =====

{
  "compilerOptions": {
    "target": "ES2022",
    "lib": ["ES2022", "DOM", "DOM.Iterable"],
    "jsx": "react-jsx",
    "module": "ESNext",
    "moduleResolution": "Bundler",
    "strict": true,
    "skipLibCheck": true,
    "noEmit": true,
    "types": ["vite/client"]
  },
  "include": ["src"]
}


===== .\vite.config.ts =====

import { defineConfig } from "vite";
import react from "@vitejs/plugin-react";
import { VitePWA } from "vite-plugin-pwa";

export default defineConfig({
  plugins: [
    react(),
    VitePWA({
      registerType: "autoUpdate",
      includeAssets: ["pwa-512x512.png", "icons/icon-192.png", "icons/icon-512.png"],
      manifest: {
        name: "Ingear",
        short_name: "Ingear",
        description: "AutomatizaciÃ³n de procesos internos - CotizaciÃ³n y mÃ³dulos por Ã¡reas",
        theme_color: "#0f766e",
        background_color: "#0b1220",
        display: "standalone",
        start_url: "/",
        icons: [
          { src: "/icons/icon-192.png", sizes: "192x192", type: "image/png" },
          { src: "/icons/icon-512.png", sizes: "512x512", type: "image/png" }
        ]
      }
    })
  ]
});


===== .\.gitignore =====



===== .\firebase.json =====



===== .\index.html =====



===== .\package.json =====



===== .\tsconfig.json =====



===== .\vite.config.ts =====

